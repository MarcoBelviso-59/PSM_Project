<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PSM — Experiments Dashboard</title>

  <!-- Stile condiviso DS1 -->
  <link rel="stylesheet" href="./styles.css" />

  <!-- Piccole aggiunte solo per layout DS4 (minime e in linea DS1) -->
  <style>
    .ds4-page { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .ds4-header { display:flex; align-items:flex-start; justify-content:space-between; gap: 16px; margin-bottom: 16px; }
    .ds4-title { margin: 0; font-size: 22px; letter-spacing: .2px; }
    .ds4-subtitle { margin-top: 6px; color: #6b7280; font-size: 13px; display:flex; align-items:center; gap: 10px; flex-wrap: wrap; }
    .ds4-pill { display:inline-flex; align-items:center; padding: 3px 10px; border-radius: 999px; background:#f3f4f6; border:1px solid #e5e7eb; font-size: 12px; color:#111827; }
    .ds4-actions { display:flex; gap: 10px; align-items:center; flex-wrap: wrap; }
    .ds4-grid { display:grid; grid-template-columns: 360px 1fr; gap: 16px; }
    .ds4-card { background:#fff; border: 1px solid #e5e7eb; border-radius: 14px; padding: 14px; }
    .ds4-card h2 { margin: 0; font-size: 16px; }
    .ds4-muted { color: #6b7280; font-size: 12px; }
    .ds4-row { display:flex; gap: 10px; align-items:center; flex-wrap: wrap; }
    .ds4-input, .ds4-select { width: 100%; max-width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid #d1d5db; background: #fff; }
    .ds4-btn { padding: 10px 14px; border-radius: 12px; border: 1px solid #111827; background: #fff; cursor: pointer; }
    .ds4-link { color: #111827; text-decoration: none; border-bottom: 1px dashed #9ca3af; }
    .ds4-link:hover { border-bottom-color:#111827; }
    .ds4-tablewrap { margin-top: 12px; max-height: 62vh; overflow:auto; border: 1px solid #eef2f7; border-radius: 12px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px 10px; border-bottom: 1px solid #f1f5f9; text-align: left; font-size: 13px; }
    thead th { position: sticky; top: 0; background: #fff; z-index: 1; }
    tr:hover { background: #fafafa; }
    .ds4-runrow { cursor: pointer; }
    .ds4-runrow.sel { background:#f8fafc; }
    .ds4-badge { display:inline-flex; align-items:center; padding: 3px 10px; border-radius: 999px; border:1px solid #e5e7eb; background:#fff; font-size: 12px; }
    .ds4-split { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
    .ds4-pre { margin: 0; padding: 12px; border-radius: 12px; background: #0b1020; color: #e5e7eb; overflow:auto; font-size: 12px; }
    .ds4-error { color: #b91c1c; font-weight: 600; }
    @media (max-width: 980px) {
      .ds4-grid { grid-template-columns: 1fr; }
      .ds4-split { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="ds4-page">
    <header class="ds4-header">
      <div>
        <h1 class="ds4-title">PSM — Experiments Dashboard (DS4)</h1>
        <div class="ds4-subtitle">
          <span>Legge le run da</span>
          <span class="ds4-pill" id="apiBasePill"></span>
          <span class="ds4-muted">Suggerimento: genera una run con <code>npm run run:sample</code></span>
        </div>
      </div>

      <div class="ds4-actions">
        <button id="btnRefresh" class="ds4-btn">Aggiorna</button>
        <a class="ds4-link ds4-muted" href="./index.html">Torna alla UI</a>
      </div>
    </header>

    <main class="ds4-grid">
      <!-- COLONNA SINISTRA: lista run -->
      <section class="ds4-card">
        <div class="ds4-row" style="justify-content:space-between;">
          <h2>Run disponibili</h2>
          <span class="ds4-muted" id="runsCount">—</span>
        </div>

        <div class="ds4-row" style="margin-top: 10px;">
          <input id="searchRunId" class="ds4-input" type="text" placeholder="Cerca runId..." />
        </div>

        <div class="ds4-row" style="margin-top: 10px;">
          <select id="sortRuns" class="ds4-select" style="width:auto;">
            <option value="desc">Ordina: più recenti</option>
            <option value="asc">Ordina: meno recenti</option>
          </select>
        </div>

        <div class="ds4-tablewrap">
          <table>
            <thead>
              <tr>
                <th>runId</th>
                <th class="ds4-muted">records</th>
              </tr>
            </thead>
            <tbody id="runsTbody">
              <tr><td colspan="2" class="ds4-muted">Caricamento…</td></tr>
            </tbody>
          </table>
        </div>

        <p class="ds4-muted" style="margin: 12px 4px 0;">
          Se la lista è vuota, esegui un esperimento (es. <code>npm run run:sample</code>) o una run custom.
        </p>
      </section>

      <!-- COLONNA DESTRA: dettaglio -->
      <section class="ds4-card">
        <div class="ds4-row" style="justify-content:space-between;">
          <div>
            <h2>Dettaglio run</h2>
            <div class="ds4-muted" id="selectedRunMeta">Seleziona una run a sinistra.</div>
          </div>

          <div class="ds4-row">
            <span class="ds4-muted">Preview</span>
            <select id="previewLimit" class="ds4-select" style="width:auto;">
              <option value="25">25</option>
              <option value="50" selected>50</option>
              <option value="100">100</option>
              <option value="200">200</option>
            </select>
          </div>
        </div>

        <div id="detailArea" style="margin-top: 12px;">
          <div class="ds4-muted">Nessuna run selezionata.</div>
        </div>
      </section>
    </main>
  </div>

  <script src="./experiments.js"></script>
</body>
</html>
