# API (DS2) — Password Evaluation Service (PSM_Project)

Questa cartella contiene (o conterrà) l’API del progetto, il cui unico compito è esporre via HTTP le funzionalità dell’engine di valutazione password. L’API non deve replicare né riscrivere le regole del meter: la “verità” sta nell’engine in `src/engine/`, e l’API si limita a validare l’input, derivare (se necessario) i token personali, invocare l’engine e restituire la risposta in un formato stabile e utile anche per esperimenti e debug.

Il contratto lato engine che l’API deve rispettare è il seguente: l’engine fornisce una valutazione tramite `evaluate(password, personalTokens)` restituendo sempre un oggetto con `score` (0–100), `level` (uno dei livelli testuali usati dal prototipo) e `patterns` (lista dei pattern rilevati); fornisce i suggerimenti tramite `generateFeedback(evaluation)` restituendo un array di stringhe; e fornisce l’esito di accettazione finale tramite `validateFinal(password, personalTokens)` restituendo `{ ok, msg }`. L’input personale del progetto è `personalTokens`, cioè un array di stringhe normalizzate derivato da nome, cognome ed email, usato per penalizzare password che contengono informazioni personali. Per questo motivo, l’API deve accettare un payload JSON che contenga sempre `password` (obbligatoria, stringa) e che possa contenere opzionalmente `personalTokens` (array di stringhe) e/o `user` (oggetto con `firstName`, `lastName`, `email`). Se nel payload sono presenti sia `personalTokens` sia `user`, allora `personalTokens` ha priorità; se `personalTokens` non è presente ma `user` sì, l’API deve derivare i token da `user` con la stessa filosofia del prototipo (normalizzazione, tokenizzazione email, esclusione dei token troppo corti).

L’endpoint principale coerente con DS2 è `POST /api/evaluate`, pensato per l’uso “real-time friendly”: riceve il payload, invoca l’engine e restituisce una risposta JSON con `score`, `level`, `patterns` e `suggestions`, dove `suggestions` è sempre ottenuto chiamando `generateFeedback({ score, level, patterns })` e non costruito “a mano” dall’API. Un esempio di request valido (con campi opzionali nello stesso JSON) è `{ "password": "P@ssw0rdExample!", "personalTokens": ["mario","rossi","example","gmail"], "user": { "firstName": "Mario", "lastName": "Rossi", "email": "mario.rossi@example.com" } }`, nel quale l’API deve usare i `personalTokens` perché presenti; un esempio di response è `{ "score": 72, "level": "Buona", "patterns": [ { "code": "LOWER_OK" }, { "code": "UPPER_OK" } ], "suggestions": [ "Aumenta la lunghezza per migliorare ulteriormente la robustezza.", "Evita sequenze prevedibili." ] }`. È inoltre previsto un endpoint di supporto `POST /api/validate`, che accetta lo stesso payload e restituisce esclusivamente l’esito di accettazione finale coerente con `validateFinal`, per esempio `{ "ok": true, "msg": "OK" }` oppure `{ "ok": false, "msg": "La password deve contenere almeno una maiuscola, una minuscola, una cifra e un simbolo." }`. La gestione errori minima deve essere rigorosa: l’API deve rispondere 400 se `password` manca o non è una stringa, o se il payload non è JSON valido; deve rispondere 500 per errori interni senza esporre stack trace o dettagli sensibili.

Dal punto di vista non funzionale, l’API deve essere deterministica (stesso input → stesso output, perché dipende dall’engine), rapida (compatibile con invocazioni frequenti durante la digitazione), e rispettosa della riservatezza: se viene introdotto logging, non deve memorizzare password in chiaro, ma al massimo informazioni tecniche aggregate. Quando si passerà all’implementazione, la scelta tecnologica può restare minimale e coerente con il prototipo JavaScript (ad esempio Node.js + Express), e l’eventuale CORS va gestito solo se UI e API sono eseguite su origini diverse. Collegamenti nel progetto: la UI in `src/web/` può continuare a chiamare l’engine direttamente (per demo locale) oppure chiamare l’API; il modulo `src/experiments/` può invocare engine o API, ma i risultati devono rimanere equivalenti e confrontabili perché derivano dallo stesso contratto.

